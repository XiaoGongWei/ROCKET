//============================================================================
//
//  This file is part of GPSTk, the GPS Toolkit.
//
//  The GPSTk is free software; you can redistribute it and/or modify
//  it under the terms of the GNU Lesser General Public License as published
//  by the Free Software Foundation; either version 3.0 of the License, or
//  any later version.
//
//  The GPSTk is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU Lesser General Public License for more details.
//
//  You should have received a copy of the GNU Lesser General Public
//  License along with GPSTk; if not, write to the Free Software Foundation,
//  Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA
//  
//  Copyright 2004, The University of Texas at Austin
//  Wei Yan - Chinese Academy of Sciences . 2009, 2010
//
//============================================================================

//============================================================================
//
//This software developed by Applied Research Laboratories at the University of
//Texas at Austin, under contract to an agency or agencies within the U.S. 
//Department of Defense. The U.S. Government retains all rights to use,
//duplicate, distribute, disclose, or release this software. 
//
//Pursuant to DoD Directive 523024 
//
// DISTRIBUTION STATEMENT A: This software has been approved for public 
//                           release, distribution is unlimited.
//
//=============================================================================

/**
* @file EarthOceanTide.hpp
* 
*/

#ifndef GPSTK_OCEAN_TIDE_HPP
#define GPSTK_OCEAN_TIDE_HPP

#include "ReferenceSystem.hpp"


namespace gpstk
{
      /** @addtogroup GeoDynamics */
      //@{

      /**
       * Solid Earth Ocean Tide
       * reference: IERS Conventions 2003
       */
   class EarthOceanTide
   {
   public:

         /// struct to hold Ocean Tide information
      struct CSR_OTIDE
      {
         double   KNMP[20];
         int      NTACT;
         int      NDOD[1200][6];
         double   CSPM[1200][4];
         int      NM[1200][2];  
      };


   public:
         /// Default constructor
      EarthOceanTide()
         : maxN(4),
           minX(0.05),
           pRefSys(NULL)
      {}

         /// Default destructor
      ~EarthOceanTide(){}


         /// load ocean data file, reference to Bernese5.0-"OT_CSRC.TID"
      void loadFile(std::string fileName, int NMAX=4, double XMIN=0.05);


         /// Set reference system
      inline EarthOceanTide& setReferenceSystem(ReferenceSystem& ref)
      {
         pRefSys = &ref;

         return (*this);
      }

         /// Get reference system
      inline ReferenceSystem* getReferenceSystem() const
      {
         return pRefSys;
      }


         /** Solid pole tide to normalized earth potential coefficients
          *
          * @param utc     time in UTC
          * @param dC      correction to normalized coefficients dC
          * @param dS      correction to normalized coefficients dS
          */
      void getOceanTide(CommonTime utc, Matrix<double>& CS);


   protected:

      /// Reference System
      ReferenceSystem* pRefSys;

      int maxN;
      double minX;

      double FAC[41];

      /// line 2
      int    NWAV;   // number of lines to skip
      int    NTOT;   // number of data lines
      int    NMX;    // max degree
      int    MMX;    // max order 
      /// line 4
      double RRE;
      double RHOW;
      double XME;
      double PFCN;
      double XXX;

      CSR_OTIDE  tideData;

      /// GRAVITY CONSTANT G, GRAV ACC ON EARTH SURFACE GE
      /// see IERS Conventions 2003 Chapter 1
      static const double G;  //= 6.67259e-11;
      static const double GE; //= 9.780327;

   }; // End of class 'EarthOceanTide'

      // @}

}  // End of namespace 'gpstk'


#endif   // GPSTK_OCEAN_TIDE_HPP
